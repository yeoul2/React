// hook í´ë”ê°€ ì—†ìœ¼ë¯€ë¡œ ë‚˜ì¤‘ì— ë¨¸ì§€í•˜ê³  ë‚˜ì„œ hookìœ¼ë¡œ ì˜®ê¸¸ ì˜ˆì •

import { useEffect, useState } from "react";

const useTokenExpirationCheck = (logout) => {
    const [isExpired, setIsExpired] = useState(false);

    useEffect(() => {
        const checkToken = () => {
            console.log("ğŸ”„ [í† í° ì²´í¬] ì‹¤í–‰ë¨!");

            const accessToken = localStorage.getItem("accessToken");
            if (!accessToken) {
                console.log("âŒ í† í° ì—†ìŒ â†’ ë¡œê·¸ì•„ì›ƒ í•„ìš”");
                setIsExpired(true);
                logout(); // âœ… ìë™ ë¡œê·¸ì•„ì›ƒ ì‹¤í–‰
                return;
            }

            // ğŸ” ì•¡ì„¸ìŠ¤ í† í° ë§Œë£Œ ì‹œê°„ í™•ì¸
            const tokenPayload = JSON.parse(atob(accessToken.split(".")[1]));
            const accessExp = tokenPayload.exp * 1000; // âœ… ë°€ë¦¬ì´ˆ ë³€í™˜
            const now = new Date().getTime();

            console.log(`ğŸ” ì•¡ì„¸ìŠ¤ í† í° ë§Œë£Œì‹œê°„: ${new Date(accessExp).toLocaleString()}`);

            if (now > accessExp) {
                console.log("âŒ ì•¡ì„¸ìŠ¤ í† í° ë§Œë£Œ â†’ ë¡œê·¸ì•„ì›ƒ í•„ìš”");
                setIsExpired(true);
                logout(); // âœ… ìë™ ë¡œê·¸ì•„ì›ƒ ì‹¤í–‰
            } else {
                setIsExpired(false);
            }
        };

        console.log("ğŸš€ [í† í° ì²´í¬] 24ì‹œê°„ë§ˆë‹¤ ì‹¤í–‰ ì„¤ì •ë¨!");
        const interval = setInterval(checkToken, 86400000); // âœ… 24ì‹œê°„ë§ˆë‹¤ ì²´í¬

        checkToken(); // âœ… í˜ì´ì§€ ë¡œë“œ ì‹œ í•œ ë²ˆ ì‹¤í–‰

        return () => {
            clearInterval(interval); // âœ… ì–¸ë§ˆìš´íŠ¸ ì‹œ ì •ë¦¬
            console.log("ğŸ›‘ [í† í° ì²´í¬] ì¤‘ì§€ë¨!");
        };
    }, [logout]); // âœ… `logout`ì´ ë³€ê²½ë  ë•Œë„ ì‹¤í–‰

    return isExpired;
};

export default useTokenExpirationCheck;

