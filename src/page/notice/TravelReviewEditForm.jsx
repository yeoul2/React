import React, { useEffect} from "react";
import "flatpickr/dist/themes/light.css";
import "flatpickr/dist/l10n/ko.js";
import Select from 'react-select';
import useBoard from "../../components/hooks/useBoard";

const TravelReviewForm = () => {
  const {
    navigate,
    customStyles,
    datePickerRef,
    flatpickrInstance,
    isDatePickerOpen,
    setIsDatePickerOpen,
    dateRange,
    setDateRange,
    title,
    setTitle,
    country,
    setCountry,
    city,
    setCity,
    actualSchedule,
    setActualSchedule,
    satisfaction,
    setSatisfaction,
    review,
    setReview,
    files,
    setFiles,
    previewUrls,
    setPreviewUrls,
    photoUrls,
    setPhotoUrls,
    visibility,
    setVisibility,
    handleImageUpload,
    handleSubmit,
    toggleDatePicker,
    options,
    aiSchedule,
    setAiSchedule,
    handleFileUpload,
    addPlace,
    addSchedule,
    removeSchedule,
    handleRemoveFile,
    departureDate,
    setDepartureDate,
    returnDate,
    setReturnDate,
    maskUserId
  } = useBoard(true); // true = ÏàòÏ†ï Î™®Îìú
  console.log(departureDate);
  console.log(returnDate);

  useEffect(() => {
    setPreviewUrls(photoUrls.filter(url => url));
  }, [photoUrls]);

  return (
    <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-20 pb-16">
      <div className="bg-white shadow sm:rounded-lg p-6">
        <h1 className="text-lg font-medium leading-6 text-gray-900 mb-4 select-none">Ïó¨Ìñâ ÌõÑÍ∏∞ ÏàòÏ†ï</h1>

        <div className="space-y-6 select-none">
          <div>
            <label className="block text-sm font-medium text-gray-700 select-none ">Ï†úÎ™©</label>
            <input
              type="text"
              className="mt-1 block w-full border-gray-300 rounded-lg shadow-sm focus:border-orange-500 focus:ring-0 focus:outline-none"
              placeholder="Ï†úÎ™©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
              value={title}
              onChange={(e) => setTitle(e.target.value)}
            />
          </div>

          <div className="grid grid-cols-1 gap-6 sm:grid-cols-2">
            <div>
              <label className="block text-sm font-medium text-gray-700 select-none">Ïó¨ÌñâÏßÄ</label>
              <div className="flex grid-cols-1 sm:grid-cols-2 select-none">
                <input
                  type="text"
                  className="mt-1 block w-full border-gray-300 rounded-lg shadow-sm focus:border-orange-500 focus:ring-0 focus:outline-none"
                  placeholder="ÎÇòÎùº"
                  value={country}
                  onChange={(e) => setCountry(e.target.value)}
                />
                <input
                  type="text"
                  className="mt-1 block w-full border-gray-300 rounded-lg shadow-sm focus:border-orange-500 focus:ring-0 focus:outline-none"
                  placeholder="ÎèÑÏãú"
                  value={city}
                  onChange={(e) => setCity(e.target.value)}
                />
              </div>
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 select-none">Ïó¨Ìñâ Í∏∞Í∞Ñ</label>
              <input
                ref={datePickerRef}
                className="mt-1 block w-full border-gray-300 rounded-lg shadow-sm focus:border-orange-500 focus:ring-0 focus:outline-none cursor-pointer"
                placeholder={`${departureDate} ~ ${returnDate}`}
                onClick={toggleDatePicker} // üìå ÌÅ¥Î¶≠ Ïãú Îã¨Î†• ÌÜ†Í∏Ä
                readOnly // üìå ÌÇ§Î≥¥Îìú ÏûÖÎ†• Î∞©ÏßÄ (Îã¨Î†•ÏúºÎ°úÎßå ÏÑ†ÌÉù)
              />
            </div>
          </div>

          {/* ÏùºÏ†ï ÎπÑÍµê */}
          <div>
            <label className="block text-sm font-medium text-gray-700 select-none">ÏùºÏ†ï ÌÉÄÏûÑÎùºÏù∏ ÎπÑÍµê</label>
            <div className="grid grid-cols-2 gap-4">

              {/* AI Ï∂îÏ≤ú ÏùºÏ†ï */}
              <div className="border border-gray-200 rounded-lg p-4">
                <div className="flex items-center mb-4">
                  <span className="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">AI Ï∂îÏ≤ú ÏùºÏ†ï</span>
                </div>
                <div className="space-y-4">
                  {aiSchedule.map((schedule, index) => (
                    <div key={index} className="border-l-2 border-blue-200 pl-4 ml-2">
                      <span className="bg-blue-50 text-blue-700 px-2 py-1 rounded text-sm">{schedule.day}</span>
                      <div className="mt-2 space-y-2">
                        <input type="text" className="w-full border-gray-300 rounded-lg" placeholder="Ïû•ÏÜå" value={schedule.place} disabled />
                        <input type="text" className="w-full border-gray-300 rounded-lg" placeholder="ÏãúÍ∞Ñ" value={schedule.time} disabled />
                        <textarea className="w-full border-gray-300 rounded-lg" rows="2" placeholder="ÏÉÅÏÑ∏ ÎÇ¥Ïö©" value={schedule.details} disabled></textarea>
                      </div>
                    </div>
                  ))}
                </div>
              </div>

              {/* Ïã§Ï†ú ÏùºÏ†ï */}
              <div className="border border-gray-200 rounded-lg p-4 ">
                <div className="flex items-center mb-4">
                  <span className="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">Ïã§Ï†ú ÏùºÏ†ï</span>
                </div >
                <div className="space-y-4">
                  {actualSchedule.map((schedule, index) => (
                    <div key={index} className="border-l-2 border-green-200 pl-4 ml-2 relative ">
                      <div className="grid grid-cols-1 gap-6 sm:grid-cols-2">
                        {/* DayÍ∞Ä Î≥ÄÍ≤ΩÎêòÏßÄ ÏïäÏúºÎ©¥ ÌïúÎ≤àÎßå ÌëúÏãú */}
                        {index === 0 || actualSchedule[index].day !== actualSchedule[index - 1].day ? (
                          <span className="bg-green-50 text-green-700 px-2 py-[2px]  rounded-full text-sm inline-flex items-center whitespace-nowrap w-fit">
                            {`DAY ${schedule.day}`}</span>
                        ) : <span className="px-2 py-1 mt-3 rounded text-sm"></span>}
                      </div>
                      <div>
                        {/* Ïû•ÏÜå Ï∂îÍ∞Ä Î≤ÑÌäº */}
                        <button
                          className="absolute top-0 right-5  text-gray-500 text-xl rounded-full p-1 mr-2 fa-solid fa-calendar-plus"
                          onClick={() => addPlace(index)}
                        >
                        </button>
                        {/* ÏùºÏ†ï ÏÇ≠Ï†ú Î≤ÑÌäº */}
                        <button
                          className="absolute top-0 right-0 text-gray-500 text-xl rounded-full p-1 fa-solid fa-calendar-minus"
                          onClick={() => removeSchedule(index)}
                        >
                        </button>
                      </div>
                      {/* ÏùºÏ†ï ÎÇ¥Ïö© */}
                      <div className="mt-2 space-y-2">
                        <input
                          type="text"
                          className="w-full border-gray-300 rounded-lg"
                          placeholder="Ïû•ÏÜå"
                          value={schedule.place}
                          onChange={(e) => {
                            const newSchedule = [...actualSchedule];
                            newSchedule[index].place = e.target.value;
                            setActualSchedule(newSchedule);
                          }}
                        />
                        <input
                          type="text"
                          className="w-full border-gray-300 rounded-lg"
                          placeholder="ÏãúÍ∞Ñ(HH:MM:SS) "
                          value={schedule.time}
                          onChange={(e) => {
                            const newSchedule = [...actualSchedule];
                            newSchedule[index].time = e.target.value;
                            setActualSchedule(newSchedule);
                          }}
                        />
                        <textarea
                          className="w-full border-gray-300 rounded-lg"
                          rows="2"
                          placeholder="ÏÉÅÏÑ∏ ÎÇ¥Ïö©"
                          value={schedule.details}
                          onChange={(e) => {
                            const newSchedule = [...actualSchedule];
                            newSchedule[index].details = e.target.value;
                            setActualSchedule(newSchedule);
                          }}
                        ></textarea>
                      </div>

                    </div>
                  ))}

                  {/* ÏùºÏ†ï Ï∂îÍ∞Ä Î≤ÑÌäº */}
                  <button
                    className="mt-4 w-full border-2 border-dashed border-gray-300 rounded-lg p-2 text-gray-500 hover:border-green-500 hover:text-green-500"
                    onClick={addSchedule}
                  >
                    + DAY Ï∂îÍ∞Ä
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        {/* ÎßåÏ°±ÎèÑ ÏÑ†ÌÉù */}
        <div>
          <label className="block text-sm font-medium text-gray-700 select-none">ÎßåÏ°±ÎèÑ</label>
          <div className="mt-2 flex items-center space-x-2">
            {[1, 2, 3, 4, 5].map((num) => (
              <span
                key={num}
                className={`text-2xl cursor-pointer hover:opacity-80 select-none`}
                onClick={() => setSatisfaction(num)}>
                <img src={`${satisfaction >= num ? "/images/ui_image/like3.png" : "/images/ui_image/unlike3.png"} `}
                  alt="" className="w-[70px] h-[70px]" />
              </span>
            ))}
          </div>
        </div>

        {/* Ïó¨Ìñâ ÌõÑÍ∏∞ ÏûÖÎ†• */}
        <div className="mt-4 select-none">
          <label className="block text-sm font-medium text-gray-700 select-none">Ïó¨Ìñâ ÌõÑÍ∏∞</label>
          <textarea
            className="mt-1 block w-full border-gray-300 rounded-lg shadow-sm focus:border-orange-500 focus:ring-0 focus:outline-none"
            rows="4"
            placeholder="Ï†ÑÎ∞òÏ†ÅÏù∏ Ïó¨Ìñâ ÌõÑÍ∏∞Î•º ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî"
            value={review}
            onChange={(e) => setReview(e.target.value)}
          ></textarea>
        </div>

        {/* ÌååÏùº ÏóÖÎ°úÎìú */}
        <div className="mt-4 select-none">
          <label className="block text-sm font-medium text-gray-700 select-none">ÏÇ¨ÏßÑ Ï≤®Î∂Ä</label>
          <div className="mt-2 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-lg relative">
            <input
              type="file"
              className="absolute inset-0 opacity-0 w-full h-full cursor-pointer"
              multiple
              accept="image/*"
              onChange={handleFileUpload}
            />

            {/* ÏóÖÎ°úÎìúÎêú Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞ */}
            {previewUrls.length > 0 ? (
              <div className="grid grid-cols-3 gap-2 w-full">
                {previewUrls.map((url, index) => (
                  <div key={index} className="relative">
                    <img src={url} alt={`ÏóÖÎ°úÎìúÎêú Ïù¥ÎØ∏ÏßÄ ${index + 1}`} className="w-full h-32 object-cover rounded-lg shadow-md" />
                    <button
                      className="absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 text-xs"
                      onClick={() => handleRemoveFile(index)}
                    >
                      ‚úï
                    </button>
                  </div>
                ))}
              </div>
            ) : (
              <div className="space-y-1 text-center">
                <i className="fas fa-cloud-upload-alt text-gray-400 text-3xl mb-3"></i>
                <p className="text-sm text-gray-600">ÌååÏùºÏùÑ ÏóÖÎ°úÎìúÌïòÎ†§Î©¥ ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî</p>
                <p className="text-xs text-gray-500">PNG, JPG, GIF up to 10MB</p>
              </div>
            )}
          </div>
        </div>

        {/* Í≥µÍ∞ú ÏÑ§Ï†ï */}
        <div className="mt-4">
          <label className="block text-sm font-medium text-gray-700">Í≥µÍ∞ú ÏÑ§Ï†ï</label>
          <Select
            className=""
            styles={customStyles}
            value={options.find(option => option.value === visibility)}
            options={options}
            onChange={(e) => setVisibility(e.value)}
          />
        </div>

        {/* Î≤ÑÌäº */}
        <div className="flex justify-end space-x-3 mt-4">
          <button
            type="button"
            className="bg-gray-200 text-gray-700 rounded-lg px-4 py-2 text-sm font-medium"
            onClick={() => navigate(-1)}
          >
            Ï∑®ÏÜå
          </button>
          <button
            type="submit"
            className="bg-custom text-white rounded-lg px-4 py-2 text-sm font-medium"
            onClick={handleSubmit}
          >
            ÏàòÏ†ïÌïòÍ∏∞
          </button>
        </div>
      </div>
    </main>
  );
};

export default TravelReviewForm;
